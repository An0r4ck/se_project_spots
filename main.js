!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_type_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};const n=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__name"),l=document.querySelector(".profile__description"),c=document.querySelector(".profile__avatar"),i=document.querySelector("#edit-profile-modal"),d=i.querySelector(".modal__close-button"),u=document.forms["edit-profile"],m=i.querySelector("#profile-name-input"),_=i.querySelector("#profile-description-input"),p=document.querySelector("#add-card-modal"),v=p.querySelector(".modal__form"),y=p.querySelector(".modal__submit-button"),f=p.querySelector(".modal__close-button"),S=p.querySelector("#add-card-caption-input"),h=p.querySelector("#add-card-link-input"),b=document.querySelector("#preview-modal"),q=b.querySelector(".modal__image"),E=b.querySelector(".modal__caption"),L=b.querySelector(".modal__close-button_type_preview"),k=document.querySelector("#card-template"),C=document.querySelector(".cards__list"),g=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()]).then((e=>{let[t,r]=e;return{cards:t,userData:r}})).catch((e=>Promise.reject(e)))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"9f8d9527-2137-4328-9593-2bba312588fc","Content-Type":"application/json"}});function x(e){const t=k.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return r.textContent=e.name,o.src=e.link,o.alt=e.name,n.addEventListener("click",(()=>{n.classList.toggle("card__like-button_liked")})),a.addEventListener("click",(()=>{t.remove()})),o.addEventListener("click",(()=>{U(b),q.src=e.link,q.alt=e.name,E.textContent=e.name})),t}function U(e){e.classList.add("modal_opened"),e.addEventListener("click",I),document.addEventListener("keydown",$)}function j(e){e.classList.remove("modal_opened"),e.removeEventListener("click",I),document.removeEventListener("keydown",$)}function I(e){e.target.classList.contains("modal")&&j(e.target)}function $(e){"Escape"===e.key&&j(document.querySelector(".modal_opened"))}function A(e){e.preventDefault(),g.editUserInfo({name:m.value,about:_.value}).then((t=>{s.textContent=t.name,l.textContent=t.about,e.target.reset(),j(i)})).catch(console.error)}var B;g.getAppInfo().then((e=>{let{cards:t,userData:r}=e;console.log(t),t.forEach((e=>{const t=x(e);C.prepend(t)})),s.textContent=r.name,l.textContent=r.about,c.src=r.avatar})).catch(console.error),L.addEventListener("click",(()=>{j(b)})),n.addEventListener("click",(()=>{var r,o;m.value=s.textContent,_.value=l.textContent,r=u,o=e,[m,_].forEach((e=>{t(r,e,o)})),U(i)})),d.addEventListener("click",(()=>{j(i)})),u.addEventListener("submit",A),a.addEventListener("click",(()=>{U(p)})),f.addEventListener("click",(()=>{j(p)})),u.addEventListener("submit",A),v.addEventListener("submit",(function(t){t.preventDefault(),console.log(S.value),console.log(h.value);const r=x({name:S.value,link:h.value});C.prepend(r),t.target.reset(),disableButton(y,e),j(p)})),B=e,document.querySelectorAll(B.formSelector).forEach((e=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(n,a,o),n.forEach((s=>{s.addEventListener("input",(function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)}))}))})(e,B)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZXRILEVBQVFDLEVBQVNBLEVBQVF1SCxrQkFBbUJ0SCxFQUc3RCxFQXFDSW1ILENBQW1CckgsRUFBUUMsRUFBU0MsR0FDcENNLEVBQWtCQyxFQUFXQyxFQUFVUixFQUN6QyxHQUFFLEdBQ0YsRUFNQWdILENBQWtCbEgsRUFBUUUsRUFBTyxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnV0dG9uX3R5cGVfZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGVycm9yTXNnLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59O1xuXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5cbi8vIGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiQWxpZW4gc3RydWN0dXJlIGluIHRoZSBkZXNlcnRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNzI1ODgyMTc2OTI4LThjZmRmODAwMGM5YT9xPTgwJnc9MTkzNiZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiSGVhdmlseSBzcGFya2luZyBjYW1wZmlyZVwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE0ODY5MTUzMDk4NTEtYjBjYzFmOGEwMDg0P3E9ODAmdz0xOTc0JmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJSYWluc2hhZnRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTgwMTkzODEzNjA1LWE1Yzc4YjRlZTAxYT9xPTgwJnc9MTk2NSZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiVG9ybmFkbyBvdmVyIGEgcm9hZFwiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE2OTU2MDUxMTc3NDUtYWU0ZTVkODVkZmIzP3E9ODAmdz0yMDY5JmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJTdGFpcnMgd2l0aCBsaWdodGluZ1wiLFxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1ODk2MTA3OTAxNzEtZGUxZWYxZTBkZGFjP3E9ODAmdz0xOTc2JmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJMaWdodG5pbmcgb3ZlciBhbiBpc2xhbmRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTAwNjc0NDI1MjI5LWY2OTI4NzViMGFiNz9xPTgwJnc9MjA3MCZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbi8vICAgfSxcbi8vIF07XG5cbi8vIFByb2ZpbGUgRWxlbWVudHNcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IGNhcmRNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuLy9Gb3JtIGVsZW1lbnRzXG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IHByb2ZpbGVDbG9zZUJ1dHRvbiA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZVwiXTtcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGNhcmRGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBjYXJkU3VibWl0QnV0dG9uID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XG5jb25zdCBjYXJkTW9kYWxDbG9zZUJ1dHRvbiA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XG5jb25zdCBjYXJkQ2FwdGlvbklucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtY2FwdGlvbi1pbnB1dFwiKTtcbmNvbnN0IGNhcmRMaW5rSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsSW1hZ2VFbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdXR0b24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvbl90eXBlX3ByZXZpZXdcIlxuKTtcblxuLy8gQ2FyZCBlbGVtZW50c1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiOWY4ZDk1MjctMjEzNy00MzI4LTk1OTMtMmJiYTMxMjU4OGZjXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKHsgY2FyZHMsIHVzZXJEYXRhIH0pID0+IHtcbiAgICBjb25zb2xlLmxvZyhjYXJkcyk7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChjYXJkKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XG4gICAgcHJvZmlsZUF2YXRhci5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuLy8gQ3JlYXRlcyBtb3JlIGNhcmQgdGVtcGxhdGVzIGRlcGVuZGluZyBvbiBvYmplY3RzIHByZXNlbnQgaW4gdGhlIGFycmF5XG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICBjb25zdCBjYXJkTmFtZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG5cbiAgY2FyZE5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XG4gIH0pO1xuXG4gIGNhcmREZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcbiAgICBwcmV2aWV3TW9kYWxDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuLy8gQWRkcyB0aGUgbW9kYWxfb3BlbmVkIGNsYXNzIHRvIHdoYXRldmVyIHRoaXMgZnVuY3Rpb24gaXMgY29ubmVjdGVkIHRvXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlTW9kYWxPbk92ZXJsYXkpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU1vZGFsT25Fc2MpO1xufVxuXG4vLyBSZW1vdmVzIHRoZSBtb2RhbF9vcGVuZWQgY2xhc3MgZnJvbSB3aGF0ZXZlciB0aGlzIGZ1bmN0aW9uIGlzIGNvbm5lY3RlZCB0b1xuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xvc2VNb2RhbE9uT3ZlcmxheSk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxPbkVzYyk7XG59XG5cbi8vIE1ha2VzIHRoZSBjbG9zZSBidXR0b24gaW4gdGhlIGZvcm1zIGFjdCBhcyBhbiBleGl0IGZvciB0aGVtXG5wcmV2aWV3TW9kYWxDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuLy8gRnVuY3Rpb24gZm9yIGNsb3NpbmcgYSBmb3JtIGlmIHlvdSBjbGljayBvdXRzaWRlIHRoZSBmb3JtJ3MgYm9yZGVyc1xuZnVuY3Rpb24gY2xvc2VNb2RhbE9uT3ZlcmxheShldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9XG59XG5cbi8vIEZ1bmN0aW9uIGZvciBjbG9zaW5nIGEgZm9ybSBpZiB5b3UgcHJlc3MgRXNjXG5mdW5jdGlvbiBjbG9zZU1vZGFsT25Fc2MoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcbiAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgfVxufVxuXG4vLyBBbGxvd3MgZm9yIGVkaXRpbmcgcHJvZmlsZSBzZWN0aW9uIGJ5IHN1Ym1pdHRpbmcgaW5mbyB0byB0aGUgY29ubmVjdGVkIGZvcm1cbmZ1bmN0aW9uIGhhbmRsZUVkaXRGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbi8vIEFsbG93cyBmb3IgY3JlYXRpbmcgYSBuZXcgY2FyZC9uZXcgcG9zdCBieSBzdWJtaXR0aW5nIGluZm8gdG8gdGhlIGNvbm5lY3RlZCBmb3JtXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc29sZS5sb2coY2FyZENhcHRpb25JbnB1dC52YWx1ZSk7XG4gIGNvbnNvbGUubG9nKGNhcmRMaW5rSW5wdXQudmFsdWUpO1xuICBjb25zdCBpbnB1dFZhbHVlcyA9IHtcbiAgICBuYW1lOiBjYXJkQ2FwdGlvbklucHV0LnZhbHVlLFxuICAgIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUsXG4gIH07XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaW5wdXRWYWx1ZXMpO1xuICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7XG4gIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgZGlzYWJsZUJ1dHRvbihjYXJkU3VibWl0QnV0dG9uLCBzZXR0aW5ncyk7XG4gIGNsb3NlTW9kYWwoY2FyZE1vZGFsKTtcbn1cblxuLy8gQWxsIGZ1bmN0aW9uYWxpdHkgZm9yIHRoZSBmb3JtIHRoYXQgb3BlbnMgd2hlbiB5b3UgY2xpY2sgXCJFZGl0IFByb2ZpbGVcIlxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XG4gIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0Rm9ybUVsZW1lbnQsXG4gICAgW2VkaXRNb2RhbE5hbWVJbnB1dCwgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRNb2RhbCk7XG59KTtcbnByb2ZpbGVDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XG59KTtcbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcblxuLy8gQWxsIGZ1bmN0aW9uYWxpdHkgZm9yIHRoZSBmb3JtIHRoYXQgb3BlbnMgd2hlbiB5b3UgY2xpY2sgXCIrIE5ldyBQb3N0XCJcbmNhcmRNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoY2FyZE1vZGFsKTtcbn0pO1xuY2FyZE1vZGFsQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xufSk7XG5lZGl0Rm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XG5jYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSlcbiAgICAgIC50aGVuKChbY2FyZHMsIHVzZXJEYXRhXSkgPT4ge1xuICAgICAgICByZXR1cm4geyBjYXJkcywgdXNlckRhdGEgfTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4gUHJvbWlzZS5yZWplY3QoZXJyKSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWwiLCJpbnB1dEVsIiwiY29uZmlnIiwicXVlcnlTZWxlY3RvciIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwiaGFzSW52YWxpZElucHV0Iiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsInByb2ZpbGVFZGl0QnV0dG9uIiwiZG9jdW1lbnQiLCJjYXJkTW9kYWxCdXR0b24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVBdmF0YXIiLCJlZGl0TW9kYWwiLCJwcm9maWxlQ2xvc2VCdXR0b24iLCJlZGl0Rm9ybUVsZW1lbnQiLCJmb3JtcyIsImVkaXRNb2RhbE5hbWVJbnB1dCIsImVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQiLCJjYXJkTW9kYWwiLCJjYXJkRm9ybSIsImNhcmRTdWJtaXRCdXR0b24iLCJjYXJkTW9kYWxDbG9zZUJ1dHRvbiIsImNhcmRDYXB0aW9uSW5wdXQiLCJjYXJkTGlua0lucHV0IiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1hZ2VFbCIsInByZXZpZXdNb2RhbENhcHRpb25FbCIsInByZXZpZXdNb2RhbENsb3NlQnV0dG9uIiwiY2FyZFRlbXBsYXRlIiwiY2FyZHNMaXN0IiwiYXBpIiwiY29uc3RydWN0b3IiLCJfcmVmIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJ0aGVuIiwiX3JlZjIiLCJjYXJkcyIsInVzZXJEYXRhIiwiY2F0Y2giLCJlcnIiLCJyZWplY3QiLCJmZXRjaCIsInJlcyIsIm9rIiwianNvbiIsInN0YXR1cyIsImVkaXRVc2VySW5mbyIsIl9yZWYzIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdXRob3JpemF0aW9uIiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbCIsImNhcmRJbWFnZUVsIiwiY2FyZExpa2VCdXR0b24iLCJjYXJkRGVsZXRlQnV0dG9uIiwic3JjIiwibGluayIsImFsdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0b2dnbGUiLCJvcGVuTW9kYWwiLCJtb2RhbCIsImNsb3NlTW9kYWxPbk92ZXJsYXkiLCJjbG9zZU1vZGFsT25Fc2MiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsImNvbnRhaW5zIiwia2V5IiwiaGFuZGxlRWRpdEZvcm1TdWJtaXQiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwicmVzZXQiLCJjb25zb2xlIiwiZXJyb3IiLCJsb2ciLCJmb3JFYWNoIiwiY2FyZCIsInByZXBlbmQiLCJhdmF0YXIiLCJyZXNldFZhbGlkYXRpb24iLCJxdWVyeVNlbGVjdG9yQWxsIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTXNnIiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9